---
title: "NFLmap for Endangered"
author: "Katie Birchard"
date: '2018-04-13'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

We want to know which populations are threatened and which ones aren't for our analyses. There are no specified coordinates online for this, but there is a map of COSEWIC endangerment status online @ http://www.asf.ca/endangered-populations.html. I'm going to make a map to compare our population locations to the locations of threatened species in Newfoundland.

```{r}
NFLclim <- read.csv("NFLD rivers lat longCSV.csv")
View(NFLclim)
NFLclim <- NFLclim[,apply(NFLclim, 2, function(x) { sum(!is.na(x)) > 0 })] # function to remove columns that just contain NA
View(NFLclim)

#making a map of the points that is not a raster map
range(NFLclim$Latitude)
range(NFLclim$Longitude)

minlat <- min(NFLclim$Latitude) 
maxlat <- max(NFLclim$Latitude)  
minlong <- min(NFLclim$Longitude) - 2
minlong
maxlong <- max(NFLclim$Longitude) + 2
maxlong
View(NFLclim)

is.numeric(minlat)

#tried to subset the world map all in one go, but it didn't like this, so had to do 2 steps
subsetMap <- subset(world_map, #world_map$long > minlong & 
											world_map$long > maxlong &
											world_map$lat > minlat) #&
											#world_map&lat < maxlong) 

subsetMap2 <- subset(subsetMap, world_map$long < minlong & world_map$lat < maxlat)
subsetMap2

baseworld_rough <- baseplot + #making a base world plot, and specifying my coordinates
	geom_polygon(data=world_map, aes(x=long, y=lat, group=group),
																					colour="green", fill="light green") +
	coord_quickmap(xlim = c(minlong,maxlong), ylim=c(minlat,maxlat))

baseworld_rough

cleanup <- theme(panel.grid.major = element_blank(), #making it pretty
				panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = 'lightblue1', colour = 'lightblue1'), 
        axis.line = element_line(colour = "white"), legend.position="none",
        axis.ticks=element_blank(), axis.text.x=element_blank(),
        axis.text.y=element_blank())

base_world <- baseworld_rough + cleanup #adding the prettiness to my rough map
base_world

NFLclim$mapcode <- c(1:nrow(NFLclim)) #coding the populations so it isn't a huge mess when I add the labels to the map

library(ggrepel) #need this package to add labels
NFLmap_coloured <- base_world + #adding the populations to my map
  geom_point(data=NFLclim,aes(x=Longitude, y=Latitude, colour=River), size=2, alpha=I(0.7)) +
	geom_text_repel(data = NFLclim, aes(Longitude, Latitude, label = mapcode), size = 3,
                  box.padding = unit(0.1, 'lines'), force = 0.5)

NFLmap_coloured

dev.copy2pdf(file="NFLmap_coloured.pdf", width = 7, height = 5) #saving the map to a pdf
```

Now I can compare the two maps to see where the populations we have lie on the COSEWIC endangerment map.
Using this resource, plus supplementary resources for the ones that aren't clear on the map, we will make another column in the dataset for threatened/non-threatened.

```{r}
data <- read.csv("ClimTrendDataNFL2.csv", header=T)
head(data)

data$mapcode <- NFLclim$mapcode
data$Status <- NA

# all the populations from Bradbury et al. 2015 are from southern NFL and have threatened status (map code 1:32)
# populations 47, 48, 67, and 73 also have threatened status

for (i in 1:nrow(data)) {
	if (data$mapcode[i] <= 32 | data$mapcode[i] %in% c(47,48,67,73)) {
		data$Status[i] <- "Threatened"
	} else {
		data$Status[i] <- "Least Concern"
	}
}

View(data)
data <- subset(data, select = -c(X.1, X)) # have some random columns that are unnecessary, so I'm deleting them

write.csv(data, "EndangermentStatusNFL.csv")
```

